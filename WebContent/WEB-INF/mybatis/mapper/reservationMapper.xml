<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="reservation">
	<insert id="insertReservation" parameterType="com.pet.reservation.Reservation">
		INSERT INTO reservation(reservationNum, checkIn, checkOut, pet_su, num, hostNum)
		VALUES (reservation_seq.NEXTVAL, #{checkIn}, #{checkOut}, #{pet_su}, #{num}, #{hostNum})	
	</insert>
	
	<sql id="where-list">
		<if test="searchKey=='userName'">
			userName=#{searchValue}
		</if>
		<if test="searchKey='accept'">
			accept=#{accept}
		</if>
	</sql>
	
	<!-- 글 개수 -->
	<select id="dataCount" parameterType="map" resultType="Integer">
		SELECT NVL(COUNT(reservationNum), 0) FROM reservation r
			JOIN member m ON r.num=m.num
			<where>
				<if test="searchValue!=null and searchValue!='' ">
					<include refid="where-list"/>
				</if>
			</where>
	</select>
	
	<!-- 글리스트 -->
	<select id="listReservation" parameterType="map" resultType="com.pet.reservation.Reservation">
		SELECT * FROM (
			SELECT ROWNUM rnum, tb.* FROM (
				SELECT h.hostNum, accept, address, userName, TO_CHAR(checkIn,'YYYY-MM-DD') checkIn, TO_CHAR(checkOut,'YYYY-MM-DD') checkOut
				FROM reservation r JOIN member m ON r.num=m.num
				JOIN host h ON m.num=h.num
				<where>
				<if test="searchValue!=null and searchValue!='' ">
					<include refid="where-list"/>
				</if>
			</where>
			ORDER BY reservationNum DESC
	<![CDATA[
			) tb WHERE ROWNUM <= #{end}
		) WHERE RNUM >= #{start}
	]]>
	</select>		

</mapper>